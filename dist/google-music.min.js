(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){window.GoogleMusic=require("./main")},{"./main":3}],2:[function(require,module,exports){function Keyboard(win){this.win=win}Keyboard.KEY_UP=38;Keyboard.KEY_DOWN=40;Keyboard.prototype={sendKey:function(element,key){var ev=this.win.document.createEvent("Events");ev.initEvent("keydown",true,true);ev.keyCode=key;ev.which=key;element.dispatchEvent(ev)}};module.exports=Keyboard},{}],3:[function(require,module,exports){var Keyboard=require("./keyboard");var Mouse=require("./mouse");function bind(context,fn){return function bindFn(){return fn.apply(context,arguments)}}function GoogleMusic(win){if(!win){throw new Error("`win` was not provided to the `GoogleMusic` constructor")}this.doc=win.document;this.keyboard=new Keyboard(win);this.mouse=new Mouse(win);var proto=GoogleMusic._protoObj;for(var protoKey in proto){if(proto.hasOwnProperty(protoKey)){this[protoKey]={};var section=proto[protoKey];for(var sectionKey in section){if(section.hasOwnProperty(sectionKey)){this[protoKey][sectionKey]=bind(this,section[sectionKey])}}if(this[protoKey].init){this[protoKey].init()}}}}var proto=GoogleMusic._protoObj={};proto.volume={init:function(){this._sliderEl=this.doc.querySelector("#vslider")},getVolume:function(){return parseInt(this.volume._sliderEl.getAttribute("aria-valuenow"),10)},setVolume:function(vol){var current=this.volume.getVolume();if(vol>current){this.volume.increaseVolume(vol-current)}else if(vol<current){this.volume.decreaseVolume(current-vol)}},increaseVolume:function(amount){if(amount===undefined){amount=1}for(var i=0;i<amount;i++){this.keyboard.sendKey(this.volume._sliderEl,Keyboard.KEY_UP)}},decreaseVolume:function(amount){if(amount===undefined){amount=1}for(var i=0;i<amount;i++){this.keyboard.sendKey(this.volume._sliderEl,Keyboard.KEY_DOWN)}}};proto.playback={init:function(){this._sliderEl=this.doc.getElementById("slider");this._playPauseEl=this.doc.querySelector('button[data-id="play-pause"]');this._forwardEl=this.doc.querySelector('button[data-id="forward"]');this._rewindEl=this.doc.querySelector('button[data-id="rewind"]');this._shuffleEl=this.doc.querySelector('button[data-id="shuffle"]');this._repeatEl=this.doc.querySelector('button[data-id="repeat"]')},STOPPED:0,PAUSED:1,PLAYING:2,LIST_REPEAT:"LIST_REPEAT",SINGLE_REPEAT:"SINGLE_REPEAT",NO_REPEAT:"NO_REPEAT",ALL_SHUFFLE:"ALL_SHUFFLE",NO_SHUFFLE:"NO_SHUFFLE",getPlaybackTime:function(){return parseInt(this._sliderEl.getAttribute("aria-valuenow"),10)},setPlaybackTime:function(milliseconds){var percent=milliseconds/parseFloat(this._sliderEl.getAttribute("aria-valuemax"));var lower=this._sliderEl.offsetLeft+6;var upper=this._sliderEl.offsetLeft+this._sliderEl.clientWidth-6;var x=lower+percent*(upper-lower);this.mouse.clickAtLocation(this._sliderEl,x,0)},playPause:function(){this.playback._playPauseEl.click()},forward:function(){this.playback._forwardEl.click()},rewind:function(){this.playback._rewindEl.click()},getShuffle:function(){return this.playback._shuffleEl.value},toggleShuffle:function(){this.playback._shuffleEl.click()},getRepeat:function(){return this.playback._repeatEl.value},changeRepeat:function(mode){if(!mode){this.playback._repeatEl.click()}else{while(this.playback.getRepeat()!==mode){this.playback._repeatEl.click()}}},toggleVisualization:function(){this.win.SJBpost("toggleVisualization")}};proto.rating={isStarsRatingSystem:function(){return this.doc.querySelector(".rating-container.stars")!==null},getRating:function(){var el=this.doc.querySelector(".player-rating-container li.selected");if(el){return el.getAttribute("data-rating")}else{return 0}},toggleThumbsUp:function(){var el=this.doc.querySelector('.player-rating-container li[data-rating="5"]');if(el){el.click()}},toggleThumbsDown:function(){var el=this.doc.querySelector('.player-rating-container li[data-rating="1"]');if(el){el.click()}},setStarRating:function(rating){var el=this.doc.querySelector('.player-rating-container li[data-rating="'+rating+'"]');if(el){el.click()}}};proto.extras={getSongURL:function(){var albumEl=this.doc.querySelector(".player-album");var artistEl=this.doc.querySelector(".player-artist");var urlTemplate="https://play.google.com/music/m/";var url=null;var parseID=function(id){return id.substring(0,id.indexOf("/"))};if(albumEl===null&&artistEl===null){return null}var albumId=parseID(albumEl.dataset.id);var artistId=parseID(artistEl.dataset.id);if(albumId){url=urlTemplate+albumId}else if(artistId){url=urlTemplate+artistId}return url}};proto.hooks={init:function(){var MutationObserver=this.win.MutationObserver||this.win.WebKitMutationObserver;var lastTitle="";var lastArtist="";var lastAlbum="";var addObserver=new MutationObserver(function(mutations){mutations.forEach(function(m){for(var i=0;i<m.addedNodes.length;i++){var target=m.addedNodes[i];var name=target.id||target.className;if(name==="text-wrapper"){var title=this.doc.querySelector("#playerSongTitle");var artist=this.doc.querySelector("#player-artist");var album=this.doc.querySelector(".player-album");var art=this.doc.querySelector("#playingAlbumArt");var duration=parseInt(this.doc.querySelector("#player #slider").getAttribute("aria-valuemax"),10)/1e3;title=title?title.innerText:"Unknown";artist=artist?artist.innerText:"Unknown";album=album?album.innerText:"Unknown";art=art?art.src:null;if(art&&art.slice(0,2)==="//"){art="https:"+art}if(lastTitle!==title||lastArtist!==artist||lastAlbum!==album){this.win.GoogleMusicApp.notifySong(title,artist,album,art,duration);lastTitle=title;lastArtist=artist;lastAlbum=album}}}})});var shuffleObserver=new MutationObserver(function(mutations){mutations.forEach(function(m){var target=m.target;var id=target.dataset.id;if(id==="shuffle"){this.win.GoogleMusicApp.shuffleChanged(target.value)}})});var repeatObserver=new MutationObserver(function(mutations){mutations.forEach(function(m){var target=m.target;var id=target.dataset.id;if(id==="repeat"){this.win.GoogleMusicApp.repeatChanged(target.value)}})});var playbackObserver=new MutationObserver(function(mutations){mutations.forEach(function(m){var target=m.target;var id=target.dataset.id;if(id==="play-pause"){var mode;var playing=target.classList.contains("playing");if(playing){mode=this.playback.PLAYING}else{if(this.doc.querySelector("#playerSongInfo").childNodes.length){mode=this.playback.PAUSED}else{mode=this.playback.STOPPED}}this.win.GoogleMusicApp.playbackChanged(mode)}})});var playbackTimeObserver=new MutationObserver(function(mutations){mutations.forEach(function(m){var target=m.target;var id=target.id;if(id==="slider"){var currentTime=parseInt(target.getAttribute("aria-valuenow"),10);var totalTime=parseInt(target.getAttribute("aria-valuemax"),10);this.win.GoogleMusicApp.playbackTimeChanged(currentTime,totalTime)}})});var ratingObserver=new MutationObserver(function(mutations){mutations.forEach(function(m){var target=m.target;if(target.classList.contains("selected")){this.win.GoogleMusicApp.ratingChanged(target.dataset.rating)}})});addObserver.observe(this.doc.querySelector("#playerSongInfo"),{childList:true,subtree:true});shuffleObserver.observe(this.doc.querySelector('#player button[data-id="shuffle"]'),{attributes:true});repeatObserver.observe(this.doc.querySelector('#player button[data-id="repeat"]'),{attributes:true});playbackObserver.observe(this.doc.querySelector('#player button[data-id="play-pause"]'),{attributes:true});playbackTimeObserver.observe(this.doc.querySelector("#player #slider"),{attributes:true});ratingObserver.observe(this.doc.querySelector("#player .player-rating-container"),{attributes:true,subtree:true})}};module.exports=GoogleMusic},{"./keyboard":2,"./mouse":4}],4:[function(require,module,exports){function Mouse(win){this.win=win}Mouse.prototype={clickAtLocation:function(element,pageX,pageY){var ev=this.win.document.createEvent("MouseEvent");ev.initMouseEvent("click",true,true,this.win,null,pageX,pageY,pageX,pageY,false,false,false,false,0,null);element.dispatchEvent(ev)}};module.exports=Mouse},{}]},{},[1]);